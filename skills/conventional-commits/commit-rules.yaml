# Conventional Commits - Generic Default Rules
# These are generic, project-agnostic commit message rules
# For project-specific customization, create `.claude/config/conventional-commits.yaml`

format:
  pattern: "{type}({scope}): {subject}"
  max_subject_length: 72
  max_body_line_length: 100

types:
  feat:
    description: "A new feature"
  fix:
    description: "A bug fix"
  refactor:
    description: "Code change that neither fixes a bug nor adds a feature"
  perf:
    description: "Performance improvement"
  test:
    description: "Adding or updating tests"
  docs:
    description: "Documentation changes"
  style:
    description: "Code style changes (formatting, whitespace)"
  build:
    description: "Build system or dependency changes"
  ci:
    description: "CI/CD configuration changes"
  chore:
    description: "Other changes that don't modify src or test files"

scopes:
  frontend:
    description: "Changes to frontend code"
    patterns:
      - "packages/frontend/**"
      - "apps/frontend/**"
      - "src/frontend/**"
      - "client/**"
      - "ui/**"

  backend:
    description: "Changes to backend code"
    patterns:
      - "packages/backend/**"
      - "apps/backend/**"
      - "src/backend/**"
      - "server/**"
      - "api/**"

  infra:
    description: "Changes to infrastructure code"
    patterns:
      - "packages/infra/**"
      - "infrastructure/**"
      - "terraform/**"
      - "cdk/**"

  config:
    description: "Configuration changes"
    patterns:
      - "config/**"
      - "*.config.*"
      - "tsconfig*.json"

  monorepo:
    description: "Changes affecting multiple packages or workspace root"
    patterns:
      - "package.json"
      - "packages/*/package.json"
      - "lerna.json"
      - "nx.json"

  tools:
    description: "Developer tooling (git hooks, scripts, linters, CI/CD)"
    patterns:
      - ".githooks/**"
      - "scripts/**"
      - ".eslintrc*"
      - "eslint.config.*"
      - ".prettierrc*"
      - ".github/workflows/**"
      - ".github/actions/**"
      - "Dockerfile"
      - "docker-compose*.yml"

  docs:
    description: "Documentation files"
    patterns:
      - "docs/**"
      - "*.md"

  project:
    description: "Project-level changes"
    patterns:
      - "CLAUDE.md"
      - ".claude/**"
      - ".gitignore"
      - ".editorconfig"

scope_selection_guide:
  description: "How to choose the correct scope based on file patterns"
  important: "Scope is determined by WHICH FILES are changed, not the type of change"

  mapping:
    frontend_files:
      pattern: "packages/frontend/**, client/**, ui/**"
      scope: "frontend"
      examples:
        - "feat(frontend): Add user login form"
        - "fix(frontend): Correct form validation"
      rationale: "Frontend code uses 'frontend' scope"

    backend_files:
      pattern: "packages/backend/**, server/**, api/**"
      scope: "backend"
      examples:
        - "feat(backend): Add user authentication API"
        - "fix(backend): Handle null user ID"
      rationale: "Backend code uses 'backend' scope"

    infrastructure_files:
      pattern: "packages/infra/**, infrastructure/**, terraform/**, cdk/**"
      scope: "infra"
      examples:
        - "feat(infra): Add CloudFront CDN"
        - "fix(infra): Correct security group rules"
      rationale: "Infrastructure code uses 'infra' scope"

    ci_cd_files:
      pattern: ".github/workflows/**"
      scope: "tools"
      examples:
        - "ci(tools): Add deployment workflow"
        - "fix(tools): Correct workflow syntax"
      rationale: "CI/CD config is developer tooling"

    docker_files:
      pattern: "Dockerfile, docker-compose*.yml"
      scope: "tools"
      examples:
        - "build(tools): Update Dockerfile base image"
        - "fix(tools): Add health check to compose"
      rationale: "Docker is developer tooling"

    config_files:
      pattern: "config/**, *.config.*, tsconfig*.json"
      scope: "config"
      examples:
        - "chore(config): Update TypeScript target"
        - "refactor(config): Standardize environment variables"
      rationale: "Configuration files use 'config' scope"

    root_package_json:
      pattern: "package.json (root)"
      scope: "monorepo"
      examples:
        - "build(monorepo): Add workspace for shared types"
        - "chore(monorepo): Update workspace configuration"
      rationale: "Root package.json affects entire workspace"

    multi_package:
      pattern: "Changes in 2+ packages"
      scope: "monorepo"
      examples:
        - "refactor(monorepo): Standardize error handling"
        - "feat(monorepo): Add shared utilities package"
      rationale: "Multi-package changes use 'monorepo' scope"

    documentation:
      pattern: "docs/**, *.md"
      scope: "docs"
      examples:
        - "docs(project): Add deployment guide"
        - "docs(project): Update README with setup instructions"
      rationale: "Documentation changes"

  common_mistakes:
    - mistake: "Using type name as scope (e.g., ci(ci):, test(test):)"
      correct: "Determine scope from file location (e.g., ci(tools):, test(frontend):)"
      explanation: "Type describes WHAT you did (ci, test, fix). Scope describes WHERE (tools, frontend, backend)."

    - mistake: "Using 'ci' as scope for GitHub Actions changes"
      correct: "Use 'tools' scope: ci(tools): ..."
      explanation: "GitHub Actions files match the 'tools' scope pattern"

    - mistake: "Using 'test' as scope for test files"
      correct: "Use package scope: test(frontend): Add E2E tests"
      explanation: "Test files are part of a package, so use that package's scope"

conventions:
  subject:
    - "Use imperative mood: 'Add feature' not 'Added feature'"
    - "Capitalize first letter when plain English (e.g., 'Add feature')"
    - "Don't capitalize if it starts with backticks, code, or special characters"
    - "No period at the end"
    - "Be specific but concise"

  body:
    - "Separate from subject with blank line"
    - "Explain what and why, not how"
    - "Wrap at 100 characters"

  footer:
    - "Breaking changes: 'BREAKING CHANGE: description'"
    - "Issue references: 'Refs #123' or 'Closes #123'"

special_cases:
  multi_package:
    scope: "monorepo"

  breaking_change:
    footer_required: true
    footer_format: "BREAKING CHANGE: <description>"

examples:
  feature:
    type: "feat"
    scope: "backend"
    subject: "Add user authentication"
    body: |
      Implement JWT-based authentication for API endpoints.

      - Add login endpoint
      - Add token validation middleware
      - Add password hashing with bcrypt
    rationale: "Backend feature with implementation details"

  bug_fix:
    type: "fix"
    scope: "frontend"
    subject: "Prevent duplicate form submissions"
    body: |
      Disable submit button after first click to prevent
      race conditions when creating resources.

      Closes #42
    rationale: "Bug fix with issue reference"

  refactor:
    type: "refactor"
    scope: "monorepo"
    subject: "Standardize error handling across packages"
    body: |
      - Implement unified error response format
      - Update frontend error display
      - Update backend error middleware
    rationale: "Multi-package refactoring"

  documentation:
    type: "docs"
    scope: "project"
    subject: "Add deployment guide"
    body: |
      Document the deployment process including Docker build,
      environment configuration, and troubleshooting steps.
    rationale: "Documentation update"

  build_dependency:
    type: "build"
    scope: "frontend"
    subject: "Update React to v18"
    body: |
      Update to React 18 for improved performance.
      Update related dependencies accordingly.
    rationale: "Dependency update for specific package"

  ci_workflow:
    type: "ci"
    scope: "tools"
    subject: "Add automated deployment workflow"
    body: |
      Configure GitHub Actions to automatically deploy
      to production on main branch push.
    rationale: "CI/CD configuration is tooling"

workflow_integration:
  description: "How to use conventional commits skill during development"
  steps:
    - "After completing a feature/fix and tests pass"
    - "Stage changes: git add ."
    - "Invoke /commit command or ask Claude to commit"
    - "Skill analyzes changed files and suggests type/scope"
    - "Review and approve generated commit message"

notes:
  - "This is a GENERIC default configuration"
  - "Create `.claude/config/conventional-commits.yaml` for project-specific rules"
  - "See `commit-rules.template.yaml` for a starter template"
  - "See `commit-rules.example.yaml` for a complete example"
