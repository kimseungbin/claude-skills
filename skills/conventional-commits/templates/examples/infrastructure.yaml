# Example Commits: Infrastructure
# Real-world commit examples from CDK infrastructure projects

description: "Example commits for infrastructure changes"

# When LLM reads this file:
# - Looking for similar commit patterns
# - Wants to see real examples of good commits
# - Needs inspiration for complex changes

# Feature additions (feat)
feat_examples:
  new_service:
    message: "feat(main): Add profile microservice"
    body: |
      Add new profile service to handle user profile management.

      - ECS service with auto-scaling
      - ALB target group configuration
      - CloudFront distribution
      - Deployed to DEV, STAGING, PROD

      Skill: conventional-commits
    why_good: "Clear what was added, scope indicates main stack orchestration"

  infrastructure_capability:
    message: "feat(service): Add auto-scaling support"
    body: |
      Implement CPU and memory-based auto-scaling for ECS services.

      - Target CPU: 70%
      - Target memory: 80%
      - Scale-in cooldown: 300s
      - Scale-out cooldown: 60s

      Skill: conventional-commits
    why_good: "Specific capability added, includes configuration details"

  monitoring:
    message: "feat(cloudfront): Add WAF rate limiting"
    body: |
      Add WAF rule to limit requests per IP address.

      Prevents DDoS attacks and excessive API usage.
      Rate limit: 2000 requests per 5 minutes

      Skill: conventional-commits
    why_good: "Security feature with clear rationale"

# Bug fixes (fix)
fix_examples:
  configuration_bug:
    message: "fix(config): Correct memory limit for auth service"
    body: |
      Fix OOM errors by increasing memory from 512MB to 1024MB.

      Auth service was experiencing frequent OOM kills during peak traffic.
      CloudWatch logs showed memory utilization at 95%+ before crashes.

      Skill: conventional-commits
    why_good: "Bug described with evidence, solution clear"

  infrastructure_bug:
    message: "fix(cloudfront): Correct WAF rule priority causing blocks"
    body: |
      Fix WAF rule ordering that was blocking legitimate traffic.

      Rule priorities were inverted, causing allow rules to be evaluated
      after block rules. Reordered to check allow list first.

      Skill: conventional-commits
    why_good: "Problem and solution clearly stated"

  deployment_bug:
    message: "fix(service): Fix health check path for profile service"
    body: |
      Correct ALB health check from /health to /api/health.

      Service was returning 404 for /health, causing false failures.
      Updated health check path to match actual endpoint.

      Skill: conventional-commits
    why_good: "Specific path correction with reasoning"

# Refactoring (refactor)
refactor_examples:
  construct_extraction:
    message: "refactor(service): Extract ServiceInfraConstruct for two-phase deployment"
    body: |
      Separate build infrastructure from runtime service for independent deployment cycles.

      - ServiceInfraConstruct: CodeBuild, ECR, pre-deployment setup
      - ServiceAppConstruct: ECS, ALB, CloudFront, application runtime

      Changes Logical IDs but preserves resource names via overrideLogicalId().
      Enables updating build infrastructure without redeploying services.

      Skill: conventional-commits
    why_good: "Clear refactoring purpose, mentions safety mechanism"

  code_organization:
    message: "refactor(infra): Move constructs to packages/infra/src/constructs/"
    body: |
      Reorganize construct hierarchy for better reusability.

      - Extract mid-level constructs to packages/
      - Maintain backward compatibility
      - No CloudFormation changes (cdk diff clean)

      Skill: conventional-commits
    why_good: "Organization improvement, confirms no infrastructure changes"

  performance_optimization:
    message: "refactor(config): Optimize Fargate resource allocation"
    body: |
      Adjust CPU/memory for better cost efficiency without degrading performance.

      - auth: 512→256 CPU, 1024MB memory (maintained)
      - yozm: 512→256 CPU, 512MB memory (low traffic service)

      Monitored for 7 days with no performance issues.

      Skill: conventional-commits
    why_good: "Optimization with monitoring confirmation"

# Chore (tooling and deployment infrastructure)
chore_examples:
  deployment_infrastructure:
    message: "chore(deployment): Add Slack notifications for pipeline"
    body: |
      Implement cross-account notification system using Lambda transformer.

      - Converts CodePipeline events to AWS Chatbot format
      - Korean localization
      - Unique Slack thread per deployment
      - GitHub commit links and AWS Console links

      Skill: conventional-commits
    why_good: "Deployment monitoring feature, clear scope"

  developer_tooling:
    message: "chore(tools): Add git pre-push hooks for deployment safety"
    body: |
      Prevent dangerous infrastructure deployments before push.

      - Runs cdk diff to detect resource replacements
      - Blocks fixed-name resource replacements (CodeBuild, ECS)
      - Requires explicit approval via commit footer

      Skill: conventional-commits
    why_good: "Tool purpose clear, safety mechanism explained"

  dependency_update:
    message: "chore(monorepo): Update aws-cdk-lib to v2.100.0"
    body: |
      Update CDK to latest stable version.

      - No breaking changes
      - Includes bug fixes for Lambda bundling
      - Tested in DEV environment

      Skill: conventional-commits
    why_good: "Dependency update with testing confirmation"

# Documentation (docs)
docs_examples:
  project_documentation:
    message: "docs(project): Update CLAUDE.md with ServiceConstruct hierarchy"
    body: |
      Document new construct organization after refactoring.

      - Add /lib/constructs section
      - Update Architecture Overview diagram
      - Document ServiceInfraConstruct and ServiceAppConstruct split

      Skill: conventional-commits
    why_good: "Documentation synchronized with code changes"

  feature_documentation:
    message: "docs(features): Add Feature #18 for two-phase service deployment"
    body: |
      Document two-phase deployment pattern in backlog.

      - Problem statement
      - Proposed solution
      - Implementation tasks (7 tasks)
      - Rollback procedures

      Skill: conventional-commits
    why_good: "Comprehensive feature documentation"

# Configuration changes (fix/refactor/feat)
config_examples:
  new_environment:
    message: "feat(types): Add Environment.QA enum"
    body: |
      Add QA environment for pre-staging testing.

      - New enum value in types/general.ts
      - Environment configuration in config.data.ts
      - AWS account mapping in bin/fe-infra.ts

      Skill: conventional-commits
    why_good: "New environment setup, clear scope"

  configuration_refactor:
    message: "refactor(config): Consolidate environment defaults"
    body: |
      Simplify configuration hierarchy by removing redundant defaults.

      - Merge dev-specific defaults into global defaults
      - Remove unused configuration fields
      - No behavior changes (tested with cdk synth)

      Skill: conventional-commits
    why_good: "Refactoring with verification"

# Pattern: Commits with deployment considerations
deployment_considerations:
  incremental_rollout:
    message: "feat(service): Add Redis cluster support"
    body: |
      Add Redis ElastiCache cluster for session storage.

      Rollout plan:
      1. Deploy to DEV, test auth service integration
      2. Deploy to STAGING, monitor for 24 hours
      3. Deploy to PROD during low-traffic window

      Skill: conventional-commits
    why_good: "Includes deployment strategy"

  breaking_change:
    message: "feat(service): Add required environment variable BASE_URL"
    body: |
      Add BASE_URL environment variable to all service task definitions.

      BREAKING CHANGE: Services will fail to start without BASE_URL in Parameter Store.
      Requires manual setup per environment before deployment.

      Setup instructions: docs/SETUP_BASE_URL.md

      Skill: conventional-commits
    why_good: "Breaking change clearly marked with setup instructions"